

# ANOVA for multiple regression using lm() and anova()


x1<- c(68.5,45.2,91.3,47.8,46.9,66.1,49.5,52.0,48.9,38.4,87.9,
       72.8,88.4,42.9,52.5,85.7,41.3,51.7,89.6,82.7,52.3)
x1
length(x1)

x2<- c(16.7,16.8,18.2,16.3,17.3,18.2,15.9,17.2,16.6,16.0,18.3,
       17.1,17.4,15.8,17.8,18.4,16.5,16.3,18.1,19.1,16.0)
x2
length(x2)

y <- c(174.4,164.4,244.2,154.6,181.6,207.5,152.8,163.2,145.4,
       137.2,241.9,191.1,232.0,145.3,161.1,209.7,146.4,144.0,
       232.6,224.1,166.5)
y

data.frame(x1, x2, y) -> datab
datab

lm(y~x1 + x2, data = datab) -> lmdatab
lmdatab


anova(lmdatab)

# What is the value for SSE Sum of Squares Error ?

# Same as Residuals in the anova output = 2180.9
# SSE = 2180.9


# What is the value for SSTO  (Sum of Squares Total)?
# SSTO = Sum Sq(x1) + Sum Sq(x2) + Sum Sq(Residuals) -> 26196.2
# SSTO = 26196.2

# Find the SSR (Sum of Squares Regression) SSTO - SSE
                                  26196.2 - 2180.9


# Find the MSE (Mean Square Error). Same as Mean Square Residuals = 121.2  
                                  
# Find R^2  (SSR/SSTO)
  
                           24015.3/26196.2
# Find R^2 using the anova table.



# Find SSTO (Sum of Squares Total) ?
length(y)


Xone <- matrix(c(1,68.5,16.7,
                 1,45.2,16.8,
                 1,91.3,18.2,
                 1,47.8,16.3,
                 1,46.9,17.3,
                 1,66.1,18.2,
                 1,49.5,15.9,
                 1,52.0,17.2,
                 1,48.9,16.6,
                 1,38.4,16.0,
                 1,87.9,18.3,
                 1,72.8,17.1,
                 1,88.4,17.4,
                 1,42.9,15.8,
                 1,52.5,17.8,
                 1,85.7,18.4,
                 1,41.3,16.5,
                 1,51.7,16.3,
                 1,89.6,18.1,
                 1,82.7,19.1,
                 1,52.3,16.0), ncol = 3, byrow = TRUE)
Xone

Yone <- matrix(c(174.4,
                 164.4,
                 244.2,
                 154.6,
                 181.6,
                 207.5,
                 152.8,
                 163.2,
                 145.4,
                 137.2,
                 241.9,
                 191.1,
                 232.0,
                 145.3,
                 161.1,
                 209.7,
                 146.4,
                 144.0,
                 232.6,
                 224.1,
                 166.5), ncol = 1, byrow = TRUE)
Yone



# J matrix 

Jmatrix <- c(1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,
             1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,
             1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,
             1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,
             1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,
             1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,
             1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,
             1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,
             1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,
             1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,
             1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,
             1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,
             1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,
             1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,
             1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,
             1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,
             1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,
             1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,
             1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,
             1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,
             1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1)
Jmatrix
length(Jmatrix)
mat21by21 <- matrix(Jmatrix,nrow = 21,ncol = 21, byrow =TRUE)
mat21by21




# Find b
t(Xone)%*%Xone -> Product3
Product3
solve(Product3)%*%t(Xone)%*%Yone -> coefficients1
coefficients1

# Find SSE
t(Yone)%*%Yone - t(coefficients1)%*%t(Xone)%*%Yone

# Find SSTO
t(Yone)%*%Yone - (1/21)*t(Yone)%*%mat21by21%*%Yone


# Find SSR
t(coefficients1)%*%t(Xone)%*%Yone - (1/21)*t(Yone)%*%mat21by21%*%Yone

2180.927 + 24015.28



